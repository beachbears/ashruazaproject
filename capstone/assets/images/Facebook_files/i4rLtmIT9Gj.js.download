;/*FB_PKG_DELIM*/

__d("LSComputeDelayForTask",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return a[0]!==void 0?b.islc(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(a,d){var e=a.done;a=a.value;return e?0:(d=a.item,b.db.table(2).fetch([[[d.taskId]]]).next().then(function(d,e){var a=d.done;d=d.value;return a?0:(e=d.item,c[5]=e.failureCount,c[4]=e.minTimeToSyncTimestampMs,b.i64.lt(c[5],b.i64.cast([0,5]))?(c[6]=b.i64.cast([0,10]),c[7]=b.i64.sub(c[5],b.i64.cast([0,1])),b.i64.gt(c[7],b.i64.cast([0,0]))?b.loopSync(c[7],function(a){return c[8]=a,c[6]=b.i64.mul(c[6],b.i64.cast([0,10]))}):0,c[1]=b.i64.lt(c[6],b.i64.cast([0,6e4]))?c[6]:b.i64.cast([0,6e4])):c[1]=b.i64.cast([0,6e4]),c[2]=b.i64.of_float(Date.now()),c[3]=b.i64.add(c[1],c[2]),b.forEach(b.db.table(2).fetch([[[e.taskId]]]),function(a){var d=a.update;a.item;return d({minTimeToSyncTimestampMs:b.i64.gt(c[3],c[4])?c[3]:c[4]})}))}))}):b.resolve()},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreComputeDelayForTaskStoredProcedure";a.__tables__=["pending_tasks"];e.exports=a}),null);
__d("LSHandleTaskSendFailureForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1],c=[],d=[];return b.sequence([function(d){return b.sequence([function(d){return b.islc(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),0,b.i64.to_float(b.i64.cast([0,1]))).next().then(function(d,e){var f=d.done;d=d.value;return f?0:(e=d.item,b.db.table(2).fetch([[[e.taskId]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?0:(f=e.item,b.i64.neq(a[1],void 0)?(c[2]=b.i64.of_float(Date.now()),c[1]=b.i64.add(c[2],a[1])):c[1]=f.minTimeToSyncTimestampMs,b.forEach(b.db.table(2).fetch([[[f.taskId]]]),function(a){var d=a.update;a.item;return d({failureCount:b.i64.add(f.failureCount,b.i64.cast([0,1])),minTimeToSyncTimestampMs:c[1]})}))}))})},function(c){return b.forEach(b.db.table(3).fetch([[[a[0],b.i64.cast([-1,4294967295])]]]),function(a){var c=a.update;a=a.item;return c({failureCount:b.i64.add(a.failureCount,b.i64.cast([0,1]))})})},function(c){return b.forEach(b.db.table(3).fetch([[[a[0],b.i64.cast([-1,4294967295])]]]),function(a){var b=a.update;a.item;return b({epochId:void 0,networkTaskIdentifier:void 0})})}])},function(a){return b.resolve(d)}])}a.__sproc_name__="LSCoreHandleTaskSendFailureForQueueStoredProcedure";a.__tables__=["pending_tasks","network_requests"];e.exports=a}),null);
__d("LSHandleFailedTask",["LSHandleTaskSendFailureForQueue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return function(a){c.logger(a).warn(a)}(a[2]),a[1]!==void 0?c.storedProcedure(b("LSHandleTaskSendFailureForQueue"),a[1],void 0):c.resolve()},function(a){return c.resolve(d)}])}a.__sproc_name__="LSCoreHandleFailedTaskStoredProcedure";a.__tables__=[];e.exports=a}),null);